<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polish Master Game</title>
    <meta name="theme-color" content="#1a73e8">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/197/197529.png">

    <style>
        :root { --primary: #1a73e8; --secondary: #34a853; --bg: #f0f2f5; --card: #fff; --text: #202124; --border: #ddd; }
        .dark-mode { --primary: #8ab4f8; --secondary: #81c995; --bg: #121212; --card: #1e1e1e; --text: #e8eaed; --border: #3c4043; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Top Bar */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--card); border-bottom: 1px solid var(--border); height: 50px; flex-shrink: 0; }
        .stats { font-weight: 800; font-size: 0.9rem; display: flex; align-items: center; gap: 15px; }
        
        /* Navigation Tabs */
        .nav-scroller { display: flex; gap: 8px; overflow-x: auto; padding: 10px; background: var(--bg); flex-shrink: 0; scrollbar-width: none; }
        .nav-btn { background: var(--card); border: 1px solid var(--border); padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; color: var(--text); white-space: nowrap; }
        .nav-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        /* Main Game Area */
        .game-area { flex-grow: 1; padding: 15px; overflow-y: auto; padding-bottom: 100px; /* Space for footer */ }
        
        /* Drawer for Settings */
        .config-drawer { display: none; background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid var(--border); }
        .config-drawer.open { display: block; animation: slideDown 0.2s; }
        .config-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        input[type=range] { width: 100%; }

        /* Big Text Display */
        .display-box { text-align: center; margin: 10px 0 20px 0; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .pl-text { font-size: 1.8rem; color: var(--primary); font-weight: 700; margin-bottom: 5px; visibility: hidden; line-height: 1.2; }
        .en-text { font-size: 1.2rem; color: #888; visibility: hidden; }
        .visible { visibility: visible !important; animation: popIn 0.3s; }

        /* Multiple Choice Grid */
        .mc-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; height: 180px; }
        .mc-btn { background: var(--card); border: 2px solid var(--border); border-radius: 12px; font-size: 1.2rem; font-weight: 700; color: var(--text); cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; }
        .mc-btn:active { transform: scale(0.96); }
        .correct { background: var(--secondary) !important; color: #fff !important; border-color: var(--secondary) !important; }
        .wrong { opacity: 0.4; background: #ff5252 !important; color: #fff !important; }

        /* Fixed Footer for Buttons */
        .footer { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card); padding: 10px; border-top: 1px solid var(--border); display: grid; gap: 8px; z-index: 9999; height: 85px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); 
            grid-template-columns: 1fr 1fr 1fr 2fr; /* 3 small buttons, 1 big next button */
        }
        .btn-action { border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; height: 100%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-listen { background: var(--primary); font-size: 1.2rem; }
        .btn-slow { background: #fb8c00; font-size: 1.2rem; }
        .btn-vslow { background: #e65100; font-size: 1.2rem; }
        .btn-next { background: #5f6368; transition: background 0.3s; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-next.ready { background: var(--secondary); }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body ontouchstart="wakeAudio()">

<div class="header">
    <div class="stats">
        <div>‚≠ê <span id="xp-display">0</span></div>
        <div>üî• <span id="streak-display">0</span></div>
    </div>
    <div style="font-size:1.5rem; cursor:pointer; padding:5px;" onclick="toggleDrawer()">‚öôÔ∏è</div>
</div>

<div class="nav-scroller">
    <button class="nav-btn active" onclick="setMode('numbers')" id="btn-mode-numbers">123</button>
    <button class="nav-btn" onclick="setMode('prices')" id="btn-mode-prices">$$$</button>
    <button class="nav-btn" onclick="setMode('dates')" id="btn-mode-dates">üìÖ</button>
    <button class="nav-btn" onclick="setMode('time')" id="btn-mode-time">üïí</button>
    <button class="nav-btn" onclick="setMode('weights')" id="btn-mode-weights">‚öñÔ∏è</button>
</div>

<div class="game-area">
    <div id="drawer" class="config-drawer">
        <div class="config-row">
            <span>Dark Mode</span>
            <input type="checkbox" onchange="document.body.classList.toggle('dark-mode')">
        </div>
        <div class="config-row" id="range-row">
            <span style="font-size:0.9rem; font-weight:bold;">Range: <span id="range-val" style="color:var(--primary)">1 - 10</span></span>
            <div style="flex:1; margin-left:15px; display:flex; gap:10px;">
                <input type="range" id="minP" min="0" max="6" value="0" oninput="updateRange()">
                <input type="range" id="maxP" min="1" max="7" value="1" oninput="updateRange()">
            </div>
        </div>
        <div class="config-row" style="justify-content:center; border-top:1px solid var(--border); padding-top:10px;">
             <label style="font-weight:bold; font-size:0.9rem;"><input type="checkbox" id="neg-toggle" onchange="generate()"> Negative Numbers</label>
        </div>
    </div>

    <div class="display-box">
        <div id="pl-text" class="pl-text">---</div>
        <div id="en-text" class="en-text">---</div>
    </div>

    <div id="mc-area" class="mc-container"></div>
</div>

<div class="footer">
    <button class="btn-action btn-listen" onclick="speak(1.0)">üîä</button>
    <button class="btn-action btn-slow" onclick="speak(0.6)">üê¢</button>
    <button class="btn-action btn-vslow" onclick="speak(0.3)">üêå</button>
    <button class="btn-action btn-next" id="main-btn" onclick="handleMainButton()">Skip ‚û°Ô∏è</button>
</div>

<script>
    // --- Data & Logic ---
    const UNITS = ["", "jeden", "dwa", "trzy", "cztery", "piƒôƒá", "sze≈õƒá", "siedem", "osiem", "dziewiƒôƒá"];
    const TEENS = ["dziesiƒôƒá", "jedena≈õcie", "dwana≈õcie", "trzyna≈õcie", "czterna≈õcie", "piƒôtna≈õcie", "szesna≈õcie", "siedemna≈õcie", "osiemna≈õcie", "dziewiƒôtna≈õcie"];
    const TENS = ["", "", "dwadzie≈õcia", "trzydzie≈õci", "czterdzie≈õci", "piƒôƒádziesiƒÖt", "sze≈õƒádziesiƒÖt", "siedemdziesiƒÖt", "osiemdziesiƒÖt", "dziewiƒôƒádziesiƒÖt"];
    const HUNDREDS = ["", "sto", "dwie≈õcie", "trzysta", "czterysta", "piƒôƒáset", "sze≈õƒáset", "siedemset", "osiemset", "dziewiƒôtset"];
    const MONTHS_PL = ["stycznia", "lutego", "marca", "kwietnia", "maja", "czerwca", "lipca", "sierpnia", "wrze≈õnia", "pa≈∫dziernika", "listopada", "grudnia"];
    const MONTHS_EN = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

    let state = { mode: 'numbers', currentPL: '', currentEN: '', solved: false, xp: 0, streak: 0 };
    let autoNextTimer = null;
    let audioCtx = null; // Web Audio API Context

    // --- Audio Engine Logic (Wake & SFX) ---
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function wakeAudio() {
        // Keeps the audio engine warm on first touch
        initAudio();
        // Play silent sound to unlock audio
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        gain.gain.value = 0.001; // Almost silent
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    function playSound(type) {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            // High Ding
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        } else {
            // Low Buzz
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }
    }

    // --- Core Functions ---
    function init() {
        state.xp = parseInt(localStorage.getItem('xp') || 0);
        updateUI();
        updateRange();
        setMode('numbers');
        // Initial speech to warm up TTS engine (volume 0)
        let warmUp = new SpeechSynthesisUtterance('');
        warmUp.volume = 0;
        window.speechSynthesis.speak(warmUp);
    }

    function generate() {
        if (autoNextTimer) clearTimeout(autoNextTimer);

        state.solved = false;
        document.getElementById('pl-text').classList.remove('visible');
        document.getElementById('en-text').classList.remove('visible');
        
        const btn = document.getElementById('main-btn');
        btn.innerText = "Skip ‚û°Ô∏è";
        btn.classList.remove('ready');
        btn.style.background = "#5f6368";

        const min = Math.pow(10, document.getElementById('minP').value);
        const max = Math.pow(10, document.getElementById('maxP').value);

        if (state.mode === 'numbers') {
            let n = Math.floor(Math.random() * (max - min + 1)) + min;
            if (document.getElementById('neg-toggle').checked && Math.random() > 0.5) n *= -1;
            state.currentEN = n.toLocaleString();
            state.currentPL = numberToPolish(n);
        } else if (state.mode === 'prices') {
            let n = Math.floor(Math.random() * (max - min + 1)) + min;
            state.currentEN = n + " z≈Ç";
            state.currentPL = numberToPolish(n) + " z≈Çotych";
        } else if (state.mode === 'dates') {
            let d = Math.floor(Math.random() * 30) + 1;
            let m = Math.floor(Math.random() * 12);
            state.currentEN = `${d} ${MONTHS_EN[m]}`;
            state.currentPL = `${d} ${MONTHS_PL[m]}`;
        } else if (state.mode === 'time') {
            let h = Math.floor(Math.random() * 24);
            let m = Math.floor(Math.random() * 12) * 5;
            state.currentEN = `${h}:${m.toString().padStart(2,'0')}`;
            state.currentPL = `${h} ${m}`;
        } else if (state.mode === 'weights') {
             let n = Math.floor(Math.random() * (max - min + 1)) + min;
             state.currentEN = n + " kg";
             state.currentPL = numberToPolish(n) + " kilogram√≥w";
        }

        document.getElementById('pl-text').innerText = state.currentPL;
        document.getElementById('en-text').innerText = state.currentEN;
        
        generateMCButtons();
        setTimeout(() => speak(1.0), 200);
    }

    function generateMCButtons() {
        const container = document.getElementById('mc-area');
        container.innerHTML = '';
        
        let opts = [state.currentEN];
        let safety = 0;
        
        while(opts.length < 4 && safety < 50) {
            let decoy = makeDecoy(state.currentEN);
            if(!opts.includes(decoy)) opts.push(decoy);
            safety++;
        }
        
        while(opts.length < 4) {
            opts.push(Math.floor(Math.random() * 100).toString() + "?");
        }

        opts.sort(() => Math.random() - 0.5);

        opts.forEach(val => {
            let b = document.createElement('button');
            b.className = 'mc-btn';
            b.innerText = val;
            b.onclick = () => check(val, b);
            container.appendChild(b);
        });
    }

    function check(val, btn) {
        if (state.solved) return;
        
        if (val === state.currentEN) {
            // WIN
            playSound('correct');
            state.solved = true;
            state.xp += 10;
            state.streak++;
            btn.classList.add('correct');
            document.getElementById('pl-text').classList.add('visible');
            document.getElementById('en-text').classList.add('visible');
            
            const mainBtn = document.getElementById('main-btn');
            mainBtn.innerText = "Next >>";
            mainBtn.classList.add('ready');
            
            autoNextTimer = setTimeout(generate, 1500);
        } else {
            // LOSE
            playSound('wrong');
            state.streak = 0;
            btn.classList.add('wrong');
        }
        updateUI();
    }

    function handleMainButton() {
        generate();
    }

    // --- Helpers ---
    function makeDecoy(target) {
        if (state.mode === 'dates') return `${Math.floor(Math.random()*30)+1} ${MONTHS_EN[Math.floor(Math.random()*12)]}`;
        if (state.mode === 'time') return `${Math.floor(Math.random()*24)}:${Math.floor(Math.random()*60).toString().padStart(2,'0')}`;
        
        let numStr = target.replace(/[^\d-]/g, '');
        let num = parseInt(numStr);
        if (isNaN(num)) num = 10;

        let diff = Math.max(1, Math.floor(Math.abs(num) * 0.3));
        let res = num + (Math.random() > 0.5 ? diff : -diff);
        
        if (state.mode === 'prices') return res + " z≈Ç";
        if (state.mode === 'weights') return res + " kg";
        return res.toLocaleString();
    }

    function numberToPolish(n) {
        if (n === 0) return "zero";
        if (n < 0) return "minus " + numberToPolish(Math.abs(n));
        if (n < 10) return UNITS[n];
        if (n < 20) return TEENS[n-10];
        if (n < 100) return TENS[Math.floor(n/10)] + (n%10 ? " " + UNITS[n%10] : "");
        if (n < 1000) return HUNDREDS[Math.floor(n/100)] + (n%100 ? " " + numberToPolish(n%100) : "");
        if (n < 1000000) {
            let k = Math.floor(n/1000);
            return (k===1 ? "tysiƒÖc" : numberToPolish(k) + " tys.") + " " + numberToPolish(n%1000);
        }
        return n.toString(); 
    }

    function updateRange() {
        let min = document.getElementById('minP').value;
        let max = document.getElementById('maxP').value;
        if(parseInt(max) <= parseInt(min)) { max = parseInt(min)+1; document.getElementById('maxP').value = max; }
        document.getElementById('range-val').innerText = `${Math.pow(10,min)} - ${Math.pow(10,max)}`;
    }

    function setMode(m) {
        state.mode = m;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-mode-'+m).classList.add('active');
        document.getElementById('range-row').style.display = (m === 'dates' || m === 'time') ? 'none' : 'flex';
        document.getElementById('neg-toggle').parentElement.parentElement.style.display = (m === 'numbers') ? 'flex' : 'none';
        generate();
    }

    function updateUI() {
        localStorage.setItem('xp', state.xp);
        document.getElementById('xp-display').innerText = state.xp;
        document.getElementById('streak-display').innerText = state.streak;
    }

    function speak(rate = 1.0) {
        window.speechSynthesis.cancel();
        let u = new SpeechSynthesisUtterance(state.currentPL);
        u.lang = 'pl-PL';
        u.rate = rate;
        window.speechSynthesis.speak(u);
    }
    
    function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }

    window.onload = init;
</script>
</body>
</html>
