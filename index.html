<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polish Master Trainer</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PL Trainer">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/197/197529.png">

    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Polish%20Master%20Trainer%22,%22short_name%22:%22PL%20Trainer%22,%22start_url%22:%22index.html%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f0f2f5%22,%22theme_color%22:%22%231a73e8%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/197/197529.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}">

    <style>
        :root { --primary: #1a73e8; --secondary: #34a853; --accent: #673ab7; --bg: #f0f2f5; --card-bg: #ffffff; --text: #202124; --border: #e0e0e0; }
        .dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text: #e8eaed; --border: #3c4043; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: var(--bg); color: var(--text); margin: 0; padding: 10px; height: 100vh; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        
        .header-section { text-align: center; margin-bottom: 10px; width: 100%; max-width: 420px; }
        .main-title { font-size: 1.1rem; font-weight: bold; text-transform: uppercase; margin: 0; }
        .header-controls { display: flex; justify-content: center; gap: 10px; margin-top: 8px; }
        .ui-btn { background: var(--card-bg); border: 1px solid var(--border); padding: 5px 12px; border-radius: 8px; font-weight: bold; font-size: 0.7rem; cursor: pointer; color: var(--text); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        .top-bar { display: flex; justify-content: center; width: 100%; max-width: 420px; margin-bottom: 10px; }
        nav { display: flex; gap: 2px; background: var(--card-bg); padding: 4px; border-radius: 50px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow-x: auto; scrollbar-width: none; }
        nav::-webkit-scrollbar { display: none; }
        nav button { background: none; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-weight: bold; color: #5f6368; font-size: 0.7rem; white-space: nowrap; }
        nav button.active { background: var(--primary); color: white; }

        .card { background: var(--card-bg); padding: 1rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 420px; display: flex; flex-direction: column; }
        .controls-row { display: flex; gap: 8px; margin-bottom: 8px; width: 100%; }
        .control-box { flex: 1; padding: 8px; background: rgba(0,0,0,0.03); border-radius: 10px; border: 1px solid var(--border); text-align: left; }
        .label-text { font-weight: bold; font-size: 0.7rem; display: block; margin-bottom: 2px; opacity: 0.8; }
        input[type=range] { width: 100%; height: 20px; cursor: pointer; }
        
        .display-area { height: 110px; margin: 8px 0; display: flex; flex-direction: column; justify-content: center; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .polish-text { font-size: 1rem; color: var(--primary); font-weight: bold; visibility: hidden; line-height: 1.2; }
        .english-text { font-size: 0.85rem; color: #888; visibility: hidden; margin-top: 4px; }
        
        .button-grid { display: flex; flex-direction: column; gap: 6px; }
        button.action { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.75rem; font-weight: 600; color: white; }
        .audio-group { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; border: 2px solid #fb8c00; padding: 6px; border-radius: 12px; }
        .btn-next { background-color: #455a64; }
        .btn-listen { background-color: var(--secondary); grid-column: span 2; }
        .btn-slow { background-color: #fb8c00; }
        .btn-v-slow { background-color: #e65100; }
        .reveal-row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .btn-reveal-pl { background-color: var(--primary); }
        .btn-reveal-en { background-color: var(--accent); }
        
        .toggle-row { display: flex; flex-direction: column; background: rgba(0,0,0,0.03); border-radius: 10px; padding: 8px; border: 1px solid var(--border); margin-bottom: 8px; gap: 8px; }
        .unit-group { display: flex; justify-content: space-around; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        .unit-group:last-child { border-bottom: none; padding-bottom: 0; }
        .unit-tag { font-size: 0.55rem; font-weight: bold; color: #888; text-transform: uppercase; width: 50px; text-align: left; }
        .toggle-item { display: flex; align-items: center; gap: 3px; font-size: 0.65rem; font-weight: bold; }

        #modalOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:1000; padding:20px; }
        .modal-content { background:var(--card-bg); color:var(--text); padding:25px; border-radius:15px; max-width:400px; width:100%; box-shadow:0 10px 25px rgba(0,0,0,0.5); }
        .modal-footer { margin-top:15px; display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--border); padding-top:10px; }
    </style>
</head>
<body>

<div class="header-section">
    <div class="main-title" id="lbl-title">Understand Spoken Polish Numbers</div>
    <div class="header-controls">
        <button class="ui-btn" onclick="toggleUILanguage()" id="uiLangBtn">EN / PL</button>
        <button class="ui-btn" onclick="toggleDarkMode()" id="lbl-dark">Dark Mode</button>
        <button class="ui-btn" onclick="showHelp()" id="lbl-help">Help</button>
    </div>
</div>

<div class="top-bar">
    <nav>
        <button id="nav-numbers" onclick="setMode('numbers')">Numbers</button>
        <button id="nav-prices" onclick="setMode('prices')">Prices</button>
        <button id="nav-dates" onclick="setMode('dates')">Dates</button>
        <button id="nav-time" onclick="setMode('time')">Time</button>
        <button id="nav-weights" onclick="setMode('weights')">Weights</button>
    </nav>
</div>

<div class="card">
    <div id="sliderContainer" class="controls-row">
        <div class="control-box">
            <span class="label-text"><span id="lbl-min">Min</span>: <span id="minValLabel">1</span></span>
            <input type="range" id="minPower" min="0" max="6" value="0" oninput="handleMinChange()">
        </div>
        <div class="control-box">
            <span class="label-text"><span id="lbl-max">Max</span>: <span id="maxValLabel">10</span></span>
            <input type="range" id="maxPower" min="1" max="7" value="1" oninput="updateSliders()">
        </div>
    </div>

    <div id="priceControls" style="display:none;">
        <div class="toggle-row" style="flex-direction: row; justify-content: center;">
            <label class="toggle-item"><input type="checkbox" id="includeGroszy" checked onchange="generateNext()"> <span id="lbl-incGrosz">Grosze</span></label>
        </div>
    </div>

    <div id="dateControls" style="display:none;">
        <div class="toggle-row" style="flex-direction: row; justify-content: space-around;">
            <label class="toggle-item"><input type="checkbox" id="includeDayOfWeek" checked onchange="generateNext()"> <span id="lbl-incDay">Day</span></label>
            <label class="toggle-item"><input type="checkbox" id="includeYear" checked onchange="generateNext()"> <span id="lbl-incYear">Year</span></label>
        </div>
    </div>

    <div id="timeControls" style="display:none;">
        <div class="toggle-row" style="flex-direction: row; justify-content: space-around;">
            <label class="toggle-item"><input type="radio" name="timeStyle" id="styleFormal" checked onchange="generateNext()"> <span id="lbl-incFormal">Formal</span></label>
            <label class="toggle-item"><input type="radio" name="timeStyle" id="styleCasual" onchange="generateNext()"> <span id="lbl-incCasual">Casual</span></label>
        </div>
    </div>

    <div id="weightControls" style="display:none;">
        <div class="toggle-row">
            <div class="unit-group">
                <span class="unit-tag">Weight</span>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="t" onchange="generateNext()"> <span>t</span></label>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="kg" checked onchange="generateNext()"> <span>kg</span></label>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="dkg" onchange="generateNext()"> <span>dkg</span></label>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="g" onchange="generateNext()"> <span>g</span></label>
            </div>
            <div class="unit-group">
                <span class="unit-tag">Volume</span>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="ml" onchange="generateNext()"> <span>ml</span></label>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="l" onchange="generateNext()"> <span>l</span></label>
                <label class="toggle-item"><input type="radio" name="weightUnit" value="szk" onchange="generateNext()"> <span>szk.</span></label>
                <label class="toggle-item" style="border-left: 1px solid #ccc; padding-left: 5px;">
                    <input type="checkbox" id="includeFractions" onchange="generateNext()"> <span id="lbl-incFrac">Frac.</span>
                </label>
            </div>
        </div>
    </div>

    <div class="display-area">
        <div id="polishText" class="polish-text">---</div>
        <div id="englishText" class="english-text">---</div>
    </div>

    <div class="button-grid">
        <button class="action btn-next" onclick="generateNext()"><span id="btn-next">Load and Play next ★</span></button>
        <div class="audio-group">
            <button class="action btn-listen" onclick="speak(1.0)"><span id="btn-listen"> Repeat</span></button>
            <button class="action btn-slow" onclick="speak(0.4)"><span id="btn-slow"> Slowly (0.4)</span></button>
            <button class="action btn-v-slow" onclick="speak(0.2)"><span id="btn-vslow"> Snail (0.2)</span></button>
        </div>
        <div class="reveal-row">
            <button class="action btn-reveal-pl" onclick="reveal('polishText')"><span id="btn-revPl">Reveal Polish</span></button>
            <button class="action btn-reveal-en" onclick="reveal('englishText')"><span id="btn-revEn">Reveal English</span></button>
        </div>
    </div>
</div>

<div id="modalOverlay">
    <div class="modal-content">
        <h3 id="help-h" style="margin-top:0; color:var(--primary);">How to Use</h3>
        <ul id="help-l" style="padding-left:20px; font-size:0.85rem; line-height:1.6;">
            <li>Select a category at the top.</li>
            <li>Adjust difficulty using the <b>Min/Max</b> sliders.</li>
            <li>Tap <b>Next</b> to hear a new number/phrase.</li>
            <li>Tap <b>Reveal</b> to check your understanding.</li>
            <li>Install this app via <b>Share > Add to Home Screen</b> to use it offline!</li>
        </ul>
        <div class="modal-footer">
            <label style="font-size:0.75rem;"><input type="checkbox" id="dontShow"> Don't show again</label>
            <button class="ui-btn" style="background:var(--primary); color:white; border:none;" onclick="closeHelp()">Start Training</button>
        </div>
    </div>
</div>

<script>
    // --- Logic & Translation ---
    let currentMode = 'numbers', uiLang = 'en', currentPolish = "", currentEnglish = "";
    const translations = {
        en: { title: "Understand Spoken Polish Numbers", numbers: "Numbers", prices: "Prices", dates: "Dates", time: "Time", weights: "Weights", min: "Min", max: "Max", incYear: "Year", incDay: "Day", incGrosz: "Grosze", incFrac: "Frac.", incFormal: "Formal", incCasual: "Casual", listen: " Repeat", slow: " Slowly (0.4)", vslow: " Snail (0.2)", revPl: "Reveal Polish", revEn: "Reveal English", next: "Load and Play next ★", helpH: "How to Use", dark: "Dark Mode", help: "Help" },
        pl: { title: "Rozumienie Polskich Liczebnik贸w", numbers: "Liczby", prices: "Ceny", dates: "Daty", time: "Czas", weights: "Waga", min: "Min", max: "Max", incYear: "Rok", incDay: "Dzie", incGrosz: "Grosze", incFrac: "U.", incFormal: "Oficjalny", incCasual: "Potoczny", listen: " Powt贸rz", slow: "Wolno (0.4)", vslow: "B.Wolno (0.2)", revPl: "Poka偶 PL", revEn: "Poka偶 EN", next: "Kolejny ★", helpH: "Jak u偶ywa", dark: "Tryb nocny", help: "Pomoc" }
    };

    const units = ["", "jeden", "dwa", "trzy", "cztery", "pi", "sze", "siedem", "osiem", "dziewi"];
    const teens = ["dziesi", "jedenacie", "dwanacie", "trzynacie", "czternacie", "pitnacie", "szesnacie", "siedemnacie", "osiemnacie", "dziewitnacie"];
    const tens = ["", "", "dwadziecia", "trzydzieci", "czterdzieci", "pidziesit", "szedziesit", "siedemdziesit", "osiemdziesit", "dziewidziesit"];
    const hundreds = ["", "sto", "dwiecie", "trzysta", "czterysta", "piset", "szeset", "siedemset", "osiemset", "dziewitset"];
    const ordinals = ["", "pierwszy", "drugi", "trzeci", "czwarty", "pity", "sz贸sty", "si贸dmy", "贸smy", "dziewity", "dziesity", "jedenasty", "dwunasty", "trzynasty", "czternasty", "pitnasty", "szesnasty", "siedemnasty", "osiemnasty", "dziewitnasty", "dwudziesty", "dwudziesty pierwszy", "dwudziesty drugi", "dwudziesty trzeci", "dwudziesty czwarty", "dwudziesty pity", "dwudziesty sz贸sty", "dwudziesty si贸dmy", "dwudziesty 贸smy", "dwudziesty dziewity", "trzydziesty", "trzydziesty pierwszy"];
    const monthsGenitive = ["stycznia", "lutego", "marca", "kwietnia", "maja", "czerwca", "lipca", "sierpnia", "wrzenia", "pa藕dziernika", "listopada", "grudnia"];
    const monthsEn = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const weekDaysPl = ["Poniedziaek", "Wtorek", "roda", "Czwartek", "Pitek", "Sobota", "Niedziela"];
    const weekDaysEn = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

    function getPluralForm(n, singular, pluralA, pluralB) {
        if (n === 1) return singular;
        const lastDigit = n % 10, lastTwo = n % 100;
        if (lastDigit >= 2 && lastDigit <= 4 && (lastTwo < 10 || lastTwo > 20)) return pluralA;
        return pluralB;
    }

    function numberToPolish(n) {
        if (n === 0) return "zero";
        let res = "";
        let mil = Math.floor(n / 1000000);
        if (mil > 0) res += (mil === 1 ? "" : numberToPolish(mil) + " ") + getPluralForm(mil, "milion", "miliony", "milion贸w") + " ";
        let thou = Math.floor((n % 1000000) / 1000);
        if (thou > 0) res += (thou === 1 ? "tysic" : numberToPolish(thou) + " " + getPluralForm(thou, "tysic", "tysice", "tysicy")) + " ";
        let rem = n % 1000, h = Math.floor(rem / 100), t = Math.floor((rem % 100) / 10), u = rem % 10;
        if (h > 0) res += hundreds[h] + " ";
        if (t === 1) res += teens[u];
        else { if (t > 1) res += tens[t] + " "; if (u > 0) res += units[u]; }
        return res.trim();
    }

    function timeToPolish(hh, mm, formal) {
        const hoursOrdFem = ["p贸noc", "pierwsza", "druga", "trzecia", "czwarta", "pita", "sz贸sta", "si贸dma", "贸sma", "dziewita", "dziesita", "jedenasta", "dwunasta", "trzynasta", "czternasta", "pitnasta", "szesnasta", "siedemnasta", "osiemnasta", "dziewitnasta", "dwudziesta", "dwudziesta pierwsza", "dwudziesta druga", "dwudziesta trzecia"];
        const hoursOrdGen = ["p贸nocy", "pierwszej", "drugiej", "trzeciej", "czwartej", "pitej", "sz贸stej", "si贸dmej", "贸smej", "dziewitej", "dziesitej", "jedenastej", "dwunastej", "pierwszej"];

        if (formal) {
            let hStr = (hh === 0) ? "zero zero" : hoursOrdFem[hh];
            let mStr = (mm === 0) ? "" : (mm < 10 ? "zero " + units[mm] : numberToPolish(mm));
            return `${hStr} ${mStr}`.trim();
        } else {
            let displayH = hh % 12;
            const hNow = hoursOrdFem[displayH === 0 ? 12 : displayH];
            const hNext = hoursOrdGen[(displayH === 0 ? 0 : displayH) + 1];
            if (mm === 0) return hNow;
            if (mm === 15) return `kwadrans po ${hoursOrdGen[displayH === 0 ? 12 : displayH]}`;
            if (mm === 30) return `wp贸 do ${hNext}`;
            if (mm === 45) return `kwadrans za ${hNext}`;
            if (mm < 30) return `${numberToPolish(mm)} po ${hoursOrdGen[displayH === 0 ? 12 : displayH]}`;
            return `za ${numberToPolish(60 - mm)} ${hNext}`;
        }
    }

    function generateNext() {
        const min = Math.pow(10, document.getElementById('minPower').value);
        const max = Math.pow(10, document.getElementById('maxPower').value);
        
        if (currentMode === 'dates') {
            const dayIdx = Math.floor(Math.random() * 7), dayNum = Math.floor(Math.random() * 31) + 1, monthIdx = Math.floor(Math.random() * 12);
            let enStr = `${dayNum} ${monthsEn[monthIdx]}`, plStr = `${ordinals[dayNum]} ${monthsGenitive[monthIdx]}`;
            if (document.getElementById('includeDayOfWeek').checked) { enStr = weekDaysEn[dayIdx] + ", " + enStr; plStr = weekDaysPl[dayIdx] + ", " + plStr; }
            if (document.getElementById('includeYear').checked) { const year = Math.floor(Math.random() * 125) + 1900; enStr += " " + year; plStr += " " + numberToPolish(year) + " roku"; }
            currentEnglish = enStr; currentPolish = plStr;
        } else if (currentMode === 'time') {
            const hh = Math.floor(Math.random() * 24), mm = [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55][Math.floor(Math.random() * 12)];
            currentEnglish = `${hh.toString().padStart(2, '0')}:${mm.toString().padStart(2, '0')}`;
            currentPolish = timeToPolish(hh, mm, document.getElementById('styleFormal').checked);
        } else if (currentMode === 'weights') {
            let unit = document.querySelector('input[name="weightUnit"]:checked').value;
            let unitNames = { t: ["tona", "tony", "ton", "tony"], kg: ["kilogram", "kilogramy", "kilogram贸w", "kilograma"], dkg: ["dekagram", "dekagramy", "dekagram贸w", "dekagrama"], g: ["gram", "gramy", "gram贸w", "grama"], ml: ["mililitr", "mililitry", "mililitr贸w", "mililitra"], l: ["litr", "litry", "litr贸w", "litra"], szk: ["szklanka", "szklanki", "szklanek", "szklanki"] };
            if (document.getElementById('includeFractions').checked && Math.random() < 0.5) {
                let fracType = Math.floor(Math.random() * 4);
                if (fracType === 0) { currentEnglish = `1/2 ${unit}`; currentPolish = `p贸 ${unitNames[unit][3]}`; }
                else if (fracType === 1) { currentEnglish = `1 1/2 ${unit}`; currentPolish = `p贸tora ${unitNames[unit][3]}`; }
                else if (fracType === 2) { let n = Math.floor(Math.random() * 8) + 2; currentEnglish = `${n} 1/2 ${unit}`; currentPolish = `${numberToPolish(n)} i p贸 ${unitNames[unit][3]}`; }
                else { let n = Math.floor(Math.random() * 8) + 2; currentEnglish = `${n} 1/4 ${unit}`; currentPolish = `${numberToPolish(n)} i wier ${unitNames[unit][3]}`; }
            } else {
                let num = Math.floor(Math.random() * (max - min + 1)) + min;
                currentEnglish = `${num.toLocaleString()} ${unit}`; currentPolish = `${numberToPolish(num)} ${getPluralForm(num, unitNames[unit][0], unitNames[unit][1], unitNames[unit][2])}`;
            }
        } else {
            let num = Math.floor(Math.random() * (max - min + 1)) + min;
            if (currentMode === 'numbers') { currentEnglish = num.toLocaleString(); currentPolish = numberToPolish(num); }
            else {
                let zlWord = getPluralForm(num, "zoty", "zote", "zotych");
                if (document.getElementById('includeGroszy').checked) {
                    let gr = Math.floor(Math.random() * 99) + 1;
                    currentEnglish = `${num.toLocaleString()},${gr.toString().padStart(2, '0')} z`;
                    currentPolish = `${numberToPolish(num)} ${zlWord} i ${numberToPolish(gr)} ${getPluralForm(gr, "grosz", "grosze", "groszy")}`;
                } else { currentEnglish = num.toLocaleString() + " z"; currentPolish = numberToPolish(num) + " " + zlWord; }
            }
        }
        document.getElementById('polishText').style.visibility = 'hidden'; document.getElementById('englishText').style.visibility = 'hidden';
        document.getElementById('polishText').innerText = currentPolish; document.getElementById('englishText').innerText = currentEnglish;
        setTimeout(() => speak(1.0), 50);
    }

    function handleMinChange() {
        const minP = parseInt(document.getElementById('minPower').value), maxSlider = document.getElementById('maxPower');
        if (parseInt(maxSlider.value) <= minP) { maxSlider.value = minP + 1; }
        updateSliders();
    }
    function updateSliders() {
        const minVal = Math.pow(10, document.getElementById('minPower').value), maxVal = Math.pow(10, document.getElementById('maxPower').value);
        document.getElementById('minValLabel').innerText = minVal.toLocaleString(); document.getElementById('maxValLabel').innerText = maxVal.toLocaleString();
    }
    function setMode(mode) {
        currentMode = mode; document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('nav-' + mode).classList.add('active');
        document.getElementById('sliderContainer').style.display = (mode === 'dates' || mode === 'time') ? 'none' : 'flex';
        document.getElementById('dateControls').style.display = (mode === 'dates') ? 'block' : 'none';
        document.getElementById('timeControls').style.display = (mode === 'time') ? 'block' : 'none';
        document.getElementById('priceControls').style.display = (mode === 'prices') ? 'block' : 'none';
        document.getElementById('weightControls').style.display = (mode === 'weights') ? 'block' : 'none';
        generateNext();
    }
    function toggleUILanguage() { uiLang = (uiLang === 'en') ? 'pl' : 'en'; updateUI(); }
    function updateUI() {
        const t = translations[uiLang];
        document.getElementById('lbl-title').innerText = t.title;
        document.getElementById('nav-numbers').innerText = t.numbers;
        document.getElementById('nav-prices').innerText = t.prices;
        document.getElementById('nav-dates').innerText = t.dates;
        document.getElementById('nav-time').innerText = t.time;
        document.getElementById('nav-weights').innerText = t.weights;
        document.getElementById('lbl-min').innerText = t.min; document.getElementById('lbl-max').innerText = t.max;
        document.getElementById('lbl-incYear').innerText = t.incYear; document.getElementById('lbl-incDay').innerText = t.incDay;
        document.getElementById('lbl-incGrosz').innerText = t.incGrosz; document.getElementById('lbl-incFrac').innerText = t.incFrac;
        document.getElementById('lbl-incFormal').innerText = t.incFormal; document.getElementById('lbl-incCasual').innerText = t.incCasual;
        document.getElementById('btn-listen').innerText = t.listen; document.getElementById('btn-slow').innerText = t.slow; document.getElementById('btn-vslow').innerText = t.vslow;
        document.getElementById('btn-revPl').innerText = t.revPl; document.getElementById('btn-revEn').innerText = t.revEn;
        document.getElementById('btn-next').innerText = t.next; document.getElementById('help-h').innerText = t.helpH;
        document.getElementById('lbl-dark').innerText = t.dark; document.getElementById('lbl-help').innerText = t.help;
        document.getElementById('uiLangBtn').innerText = (uiLang === 'en') ? 'EN / PL' : 'PL / EN';
    }
    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    function showHelp() { document.getElementById('modalOverlay').style.display = 'flex'; }
    function closeHelp() { if (document.getElementById('dontShow').checked) localStorage.setItem('hidePolishHelp', 'true'); document.getElementById('modalOverlay').style.display = 'none'; }
    function speak(rate) {
        if (!currentPolish || currentPolish === "---") return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(currentPolish); u.lang = 'pl-PL'; u.rate = rate; window.speechSynthesis.speak(u);
    }
    function reveal(id) { document.getElementById(id).style.visibility = 'visible'; }

    // --- Service Worker & PWA Init ---
    window.onload = () => { 
        updateSliders(); updateUI(); setMode('numbers'); 
        if (!localStorage.getItem('hidePolishHelp')) showHelp();

        // Register Service Worker for Offline access
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'pl-trainer-v1';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(['index.html'])));
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(caches.match(e.request).then(res => res || fetch(e.request)));
                });
            `;
            const blob = new Blob([swCode], {type: 'application/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }
    };
</script>
</body>
</html>
